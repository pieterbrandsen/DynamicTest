@page "/"
@using DynamicTest.Core.Helper
@using Newtonsoft.Json.Linq
@using DynamicTest.Core.Converter
@using DynamicTest.Web.Components;
@using System.ComponentModel
@using System.Dynamic
@using System.Net
@using DynamicTest.Core.Models
@using Microsoft.AspNetCore.Components.Rendering

    <TableGenerator Data="@Orders"></TableGenerator>

<InputFile OnChange="OnFileInput"/>
    @code {

    public List<DynamicDictionary> Orders = new List<DynamicDictionary>() { };
    protected override void OnInitialized()
    {
        Orders = Enumerable.Range(1, 75).Select((x) =>
        {
            dynamic d = new DynamicDictionary();
            d.OrderID = 1000 + x;
            d.CustomerID = (new string[] { "ALFKI", "ANANTR", "ANTON", "BLONP", "BOLID" })[new Random().Next(5)];
            d.Freight = (new double[] { 2, 1, 4, 5, 3 })[new Random().Next(5)] * x;
            d.OrderDate = (new DateTime[] { new DateTime(2010, 11, 5), new DateTime(2018, 10, 3), new DateTime(1995, 9, 9), new DateTime(2012, 8, 2), new DateTime(2015, 4, 11) })[new Random().Next(5)];
            d.ShipCountry = (new string[] { "USA", "UK" })[new Random().Next(2)];
            d.Verified = (new bool[] { true, false })[new Random().Next(2)];
            return d;
        }).Cast<DynamicDictionary>().ToList<DynamicDictionary>();
    }

    private JObject TableData { get; set; }
    private string Path { get; set; }

    private async void OnFileInput(InputFileChangeEventArgs e)
    {
        Path = await FileWriter.Json(e.File);
        var content = FileReader.Json(Path);
        var obj = JsonConverter.ConvertJsonStringToObject<JObject>(content);
        TableData = obj;
        StateHasChanged();
    }
}